{
  "version": 3,
  "sources": ["../src/rsa/safePow.ts", "../src/BinaryHelper.ts", "../src/Asn1Encoder.ts", "../src/rsa/KeyPair.ts", "../src/rsa/RSAGenerator.ts", "../src/SeededRandom.ts", "../src/SeededRSA.ts", "../src/index.ts"],
  "sourcesContent": ["export default function safePow(a, b, n) {\n    a = BigInt(a);\n    b = BigInt(b);\n    n = BigInt(n);\n\n    a = a % n;\n    let result = 1n;\n    let x = a;\n\n\n    while (b > 0) {\n        let leastSignificantBit = b % 2n;\n        b = b / 2n;\n\n        if (leastSignificantBit === 1n) {\n            result = result * x;\n            result = result % n;\n        }\n\n        x = x * x;\n        x = x % n;\n    }\n\n    return result;\n}", "export default abstract class BinaryHelper {\n    static bigIntToString(input: bigint): string {\n        let string = \"\";\n\n        while (input !== 0n) {\n            string = String.fromCharCode(Number(input & 255n)) + string;\n            input = input >> 8n;\n        }\n\n        return string;\n    }\n    \n    static stringToBigInt(input: string): bigint {\n        let chars = input.split(\"\");\n        let bigInt = 0n;\n\n        for (let char of chars) {\n            let charCode = char.charCodeAt(0);\n\n            bigInt = bigInt << 8n;\n            bigInt = bigInt | BigInt(charCode);\n        }\n\n        return bigInt;\n    }\n    \n    static bigIntToBase64(input: bigint): string {\n        return btoa(BinaryHelper.bigIntToString(input));\n    }\n}", "export default class Asn1Encoder {\n    sequence(...rest: bigint[]) {\n        let value = 0n;\n        for (let bigint of rest) {\n            value = this.pushBytes(value, bigint);\n        }\n        \n        return this.createComponent(0x30n, value);\n    }\n    \n    integer(input: bigint) {\n        return this.createComponent(0x02n, input);\n    }\n    \n    unsignedInteger(input: bigint) {\n        let value = 0n;\n        value = this.pushBits(value, input);\n        \n        return this.integer(value);\n    }\n    \n    private getByteLength(input: bigint): bigint {\n        let bytes = Math.ceil(input.toString(2).length / 8) * 8;\n        return BigInt(bytes);\n    }\n    \n    private pushBits(input: bigint, bits: bigint): bigint {\n        input = input << BigInt(bits.toString(2).length);\n        return input | bits;\n    }\n    \n    private pushBytes(input: bigint, bits: bigint): bigint {\n        input = input << this.getByteLength(bits);\n        return input | bits;\n    }\n    \n    private createComponent(header: bigint, value: bigint, unsigned: boolean = false): bigint {\n        let out = 0n;\n        out = this.pushBytes(out, header);\n        \n        let valueBytes = this.getByteLength(value) / 8n;\n        let undefinedLength = false;\n        \n        if (valueBytes < 127) {\n            out = this.pushBytes(out, valueBytes);\n        } else {\n            let lengthBytes = this.getByteLength(valueBytes) / 8n;\n            \n            if (lengthBytes < 127) {\n                let lengthHeader = 1n << 7n;\n                lengthHeader = lengthHeader | lengthBytes;\n                lengthHeader = this.pushBytes(lengthHeader, valueBytes);\n                \n                out = this.pushBytes(out, lengthHeader);\n            } else {\n                out = out << 8n; // 0x00\n                undefinedLength = true;\n            }\n        }\n        \n        if (unsigned) {\n            \n        }\n        \n        out = this.pushBytes(out, value);\n        \n        if (undefinedLength) {\n            out = out << 8n; // 0x00\n            out = out << 8n; // 0x00\n        }\n        \n        return out;\n    }\n}", "import safePow from \"./safePow\";\nimport BinaryHelper from \"../BinaryHelper\";\nimport Asn1Encoder from \"../Asn1Encoder\";\n\nexport default class KeyPair {\n    private readonly p: bigint;\n    private readonly q: bigint;\n    private readonly e: bigint;\n    private readonly N: bigint;\n    private readonly L: bigint;\n    private readonly d: bigint;\n    \n    constructor(p: bigint, q: bigint, e: bigint) {\n        this.p = p;\n        this.q = q;\n        this.e = e;\n        \n        this.N = p * q;\n        this.L = (p - 1n) * (q - 1n);\n        this.d = this.modInverse(e, this.L);\n    }\n    \n    encrypt(message: string) {\n        return safePow(BinaryHelper.stringToBigInt(message), this.e, this.N);\n    }\n    \n    decrypt(message: bigint) {\n        return BinaryHelper.bigIntToString(safePow(message, this.d, this.N));\n    }\n    \n    getPublic() {\n        let encoder = new Asn1Encoder();\n        \n        return BinaryHelper.bigIntToBase64(\n            encoder.sequence(\n                encoder.unsignedInteger(this.N),\n                encoder.unsignedInteger(this.e)\n            )\n        );\n    }\n    \n    private modInverse(a: bigint, n: bigint): bigint {\n        let n0 = n;\n        let y = 0n;\n        let x = 1n;\n\n        if (n == 1n) return 0n;\n\n        while (a > 1n) {\n            let q = a / n;\n            let t = n;\n\n            n = a % n;\n            a = t;\n            t = y;\n\n            y = x - q * t;\n            x = t;\n        }\n\n        if (x < 0) {\n            x = x + n0\n        }\n\n        return x;\n    }\n}", "import KeyPair from \"./KeyPair\";\nimport safePow from \"./safePow\";\n\nexport default abstract class RSAGenerator {\n    private readonly n: number;\n    private readonly e: number;\n    \n    public k: number = 500;\n    public ensureKey: boolean = true;\n    \n    protected abstract randomBit(): boolean;\n    \n    constructor(n: number, e: number) {\n        this.n = n;\n        this.e = e;\n    }\n    \n    async generateKeys() {\n        let p = await this.generateComponent(this.n / 2);\n        let q = await this.generateComponent(this.n - (this.n / 2));\n        \n        if (p < q) {\n            let t = p;\n            p = q;\n            q = t;\n        }\n        \n        return new KeyPair(p, q, BigInt(this.e));\n    }\n    \n    private async generateComponent(length: number, e: bigint = 65537n): Promise<bigint> {\n        let component = e + 1n;\n        \n        while (component % e === 1n) {\n            component = await this.generatePrime(length);\n        }\n        \n        return component;\n    }\n    \n    private async generatePrime(length: number): Promise<bigint> {\n        while (this.ensureKey) {\n            let randomBigint = this.randomBigintFromLength(length, 0b11n);\n            randomBigint = randomBigint | 1n;\n            \n            let result = this.findPrime(length, randomBigint);\n            \n            if (result !== 0n) {\n                return result;\n            }\n            \n            if (!this.ensureKey) {\n                throw new Error(\"No prime after K\");\n            }\n        }\n    }\n    \n    private randomBigintFromLength(n: number, component: bigint = 0n): bigint {\n        let offset = component.toString(2).length;\n        \n        for (let i = 0; i < (n - offset); i++) {\n            component = component << 1n;\n            \n            if (this.randomBit()) {\n                component = component | 1n;\n            }\n        }\n        \n        return component;\n    }\n    \n    private findPrime(n: number, startingNumber: bigint): bigint {\n        let number = startingNumber;\n        \n        let maxK = (n * Math.log(2)) / 2;\n        \n        for (let i = 0; i < maxK; i++) {\n            if (this.checkPrime(number)) {\n                return number;\n            }\n\n            number += 2n;\n        }\n        \n        return 0n;\n    }\n    \n    private checkPrime(n: bigint): boolean {\n        if (n === 2n || n === 3n) {\n            return true;\n        }\n\n        if (n % 2n === 0n || n < 2n) {\n            return false;\n        }\n        \n        for (let i = 2n; i < 1000n; i++) {\n            if (n % i === 0n) {\n                return false;\n            }\n        }\n        \n        return this.millerRabin(n);\n    }\n    \n    private millerRabin(n: bigint): boolean {\n        let s = 0n;\n        let d = n - 1n;\n        \n        while ((d & 1n) === 0n) {\n            d >>= 1n;\n            ++s;\n        }\n        \n        let base = 2n;\n        let x = safePow(base, d, n);\n        \n        if (x === 1n || x === n - 1n) {\n            return true;\n        }\n        \n        for (let i = 0n; i <= s; i++) {\n            x = safePow(x, x, n);\n            \n            if (x === n - 1n) {\n                return true;\n            }\n        }\n        \n        return false;\n    }\n}", "export default class SeededRandom {\n    private currentValue: number;\n    \n    constructor(seed: number) {\n        this.currentValue = seed;\n    }\n    \n    next() {\n        return this.currentValue = this.currentValue * 16807 % 2147483647;\n    }\n}", "import RSAGenerator from \"./rsa/RSAGenerator\";\nimport KeyPair from \"./rsa/KeyPair\";\nimport SeededRandom from \"./SeededRandom\";\n\nexport default class SeededRSA extends RSAGenerator {\n    private randomGenerator: SeededRandom;\n    \n    protected randomBit(): boolean {\n        return this.randomGenerator.next() % 2 === 0;\n    }\n\n    async generateSeeded(seed: number) {\n        this.randomGenerator = new SeededRandom(seed);\n        return super.generateKeys();\n    }\n}", "import CryptoRSA from \"./CryptoRSA\";\nimport SeededRSA from \"./SeededRSA\";\n\nasync function main() {\n    let generator = new SeededRSA(2048, 65537);\n    let keys = await generator.generateSeeded(657575);\n\n    console.log(keys.getPublic());\n    // console.log(keys.bigIntToBase64(0b01001101n));\n    // console.log(keys.encrypt(\"Hello world\").toString());\n}\n\nmain();\n\n// import Asn1Encoder from \"./Asn1Encoder\";\n// import BinaryHelper from \"./BinaryHelper\";\n//\n// let encoder = new Asn1Encoder();\n//\n// let encodedValue = encoder.sequence(\n//     encoder.integer(12n),\n//     encoder.integer(12n),\n// );\n// console.log(encodedValue.toString(2));\n// console.log(BinaryHelper.bigIntToBase64(encodedValue));\n"],
  "mappings": "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",
  "names": []
}
